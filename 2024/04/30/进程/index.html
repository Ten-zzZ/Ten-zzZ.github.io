<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>进程 | Ten-zzZ</title><meta name="keywords" content="进程,linux"><meta name="author" content="Ten"><meta name="copyright" content="Ten"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="进程"><meta name="application-name" content="进程"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="进程"><meta property="og:url" content="http://example.com/2024/04/30/%E8%BF%9B%E7%A8%8B/index.html"><meta property="og:site_name" content="Ten-zzZ"><meta property="og:description" content="程序与进程程序：是可执行文件，其本质是是一个文件，程序是静态的，同一个程序可以运行多次，产生多个进程 进程：它是程序的一次运行过程，当应用程序被加载到内存中运行之后它就称为了一个进程，进程是动态的，进程的生命周期是从程序运行到程序退出 父子进程：当一个进程A通过frok()函数创建出进程B，A为B的"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://img2.imgtp.com/2024/04/30/ZamtkUJE.jpg"><meta property="article:author" content="Ten"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://img2.imgtp.com/2024/04/30/ZamtkUJE.jpg"><meta name="description" content="程序与进程程序：是可执行文件，其本质是是一个文件，程序是静态的，同一个程序可以运行多次，产生多个进程 进程：它是程序的一次运行过程，当应用程序被加载到内存中运行之后它就称为了一个进程，进程是动态的，进程的生命周期是从程序运行到程序退出 父子进程：当一个进程A通过frok()函数创建出进程B，A为B的"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2024/04/30/%E8%BF%9B%E7%A8%8B/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2023/09/03/125766904/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: undefined,
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: {"mode":"api","api":"https://github.com/anzhiyu-c/img2color-go","cover_change":true},
  authorStatus: {"skills":["🌐 浏览器里的探险家"]},
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: Ten","link":"链接: ","source":"来源: Ten-zzZ","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Ten-zzZ',
  title: '进程',
  postAI: '',
  pageFillDescription: '程序与进程, 进程的创建, 应用场景：, fork()：, vfork(), 父子数据共享, 父子竞争, 进程退出, 监视子进程, wait(), waitpid(), waitid(), 孤儿进程, 僵尸进程, 总结, 守护进程, exec簇函数, execve(), execl(), execv, execlp()execvp(), execle()与execvpe(), 使用exec簇函数执行ls命令, execl, execv, execlp, execvp, execle, execvpe, system函数, popen函数程序与进程程序是可执行文件其本质是是一个文件程序是静态的同一个程序可以运行多次产生多个进程进程它是程序的一次运行过程当应用程序被加载到内存中运行之后它就称为了一个进程进程是动态的进程的生命周期是从程序运行到程序退出父子进程当一个进程通过函数创建出进程为的父进程为的子进程进程号也称进程标识符是一个非负整数用于唯一标识系统下某一个进程交换进程进程中可以使用查看系统中的所有进程可配合管道进行使用该系统调用用于获取当前进程的用于获取父进程的进程的创建一个现有的进程可以调用函数创建一个新的进程调用函数的进程称为父进程由函数创建出来的进程被称为子进程函数原型如下所示为系统调用应用场景在诸多的应用中创建多个进程是任务分解时行之有效的方法譬如某一网络服务器进程可在监听客户端请求的同时为处理每一个请求事件而创建一个新的子进程与此同时服务器进程会继续监听更多的客户端连接请求一个进程要执行不同的程序譬如在程序中调用函数创建了子进程此时子进程是要去执行另一个程序也就是子进程需要执行的代码是程序对应的代码子进程将从程序的函数开始运行这种情况通常在子进程从函数返回之后立即调用族函数来实现关于函数将在后面内容向大家介绍作用用于创建一个子进程原型如下理解系统调用的关键在于完成对其调用后将存在两个进程一个是原进程父进程另一个则是创建出来的子进程并且每个进程都会从函数的返回处继续执行会导致调用返回两次值子进程返回一个值父进程返回一个值创建一个子进程子进程从这开始执行父子进程都会执行该语句调用成功后会在父进程中返回子进程的而在子进程中返回值是如果调用失败父进程返回值不创建子进程并设置返回值总结父子进程都会从函数的返回处继续执行父进程返回子进程调用失败返回子进程返回这是子进程打印的信息父进程子进程子进程使用退出这是父进程打印的信息父进程子进程也是用于创建子进程返回值与一样原型如下与区别直接使用父进程存储空间不拷贝与一样都创建了子进程但函数并不会将父进程的地址空间完全复制到子进程中因为子进程会立即调用于是也就不会引用该地址空间的数据不过在子进程调用或之前它在父进程的空间中运行子进程共享父进程的内存这种优化工作方式的实现提高的效率但如果子进程修改了父进程的数据除了返回值的变量进行了函数调用或者没有调用或就返回将可能带来未知的结果保证子进程先运行当子进程调用退出后父进程才执行保证子进程先运行子进程调用之后父进程才可能被调度运行虽然系统调用在效率上要优于但是可能会导致一些难以察觉的程序所以尽量避免使用来创建子进程虽然在效率上并没有高但是现代的系统内核已经采用了写时复制技术来实现其效率较之于早期的实现要高出许多除非速度绝对重要的场合父子数据共享使用创建子进程后子进程会把父进程中的数据拷贝一份该实验中子进程对进行了操作但是不影响父进程中的创建子进程子进程中改变数据我是子进程我是父进程使用创建子进程子进程不会拷贝父进程中的数据而是直接使用父进程中的数据子进程中更改数据也影响父进程中的数据创建子进程子进程中改变数据我是子进程我是父进程父子竞争调用之后子进程成为了一个独立的进程可被系统调度运行而父进程也继续被系统调度运行那么谁先访问呢答案是不确定的父子进程运行顺序不确定从测试结果可知虽然绝大部分情况下父进程会先于子进程被执行但是并不排除子进程先于父进程被执行的可能性我是子进程我是父进程进程退出进程退出包括正常退出和异常退出正常退出函数中通过语句返回来终止进程应用程序中调用函数终止进程应用程序中调用或终止进程补充进程中最后一个线程返回进程也会退出最后一个线程调用异常退出应用程序中调用函数终止进程进程接收到一个信号譬如信号一般使用库函数而非系统调用原因在于最终也会通过终止进程但在此之前它将会完成一些其它的工作函数会执行的动作如下如果程序中注册了进程终止处理函数那么会调用终止处理函数刷新流缓冲区执行系统调用传入状态码用于标识为啥退出表示正常退出表示异常退出监视子进程就是等待子进程退出对于许多需要创建子进程的进程来说有时设计需要监视子进程的终止时间以及终止时的一些状态信息在某些设计需求下这是很有必要的系统调用可以等待进程的任一子进程终止同时获取子进程的终止状态信息函数的作用除了获取子进程的终止状态信息之外更重要的一点就是回收子进程的一些资源俗称为子进程收尸其函数原型如下所示参数介绍参数用于存放子进程终止时的状态信息参数可以为表示不接收子进程终止时的状态信息返回值若成功则返回终止的子进程对应的进程号失败则返回系统调用将执行如下动作一次调用只能处理一次调用函数如果其所有子进程都还在运行则会一直阻塞等待直到某一个子进程终止如果进程调用但是该进程并没有子进程也就意味着该进程并没有需要等待的子进程那么将返回错误也就是返回并且会将设置为如果进程调用之前它的子进程当中已经有一个或多个子进程已经终止了那么调用也不会阻塞而是会立即替该子进程收尸处理它的后事循环创建个子进程子进程子进程被创建父进程跳出没有需要等待回收的子进程回收子进程终止状态用系统调用存在着一些限制这些限制包括如下如果父进程创建了多个子进程使用将无法等待某个特定的子进程的完成只能按照顺序等待下一个子进程的终止一个一个来谁先终止就先处理谁如果子进程没有终止正在运行那么总是保持阻塞有时我们希望执行非阻塞等待是否有子进程终止通过判断即可得知使用只能发现那些被终止的子进程对于子进程因某个信号譬如信号而停止注意这里停止指的暂停运行或是已停止的子进程收到信号后恢复执行的情况就无能为力了函数原型参数介绍参数用于表示需要等待的某个具体子进程关于参数的取值范围如下如果大于表示等待进程号为的子进程如果等于则等待与调用进程父进程同一个进程组的所有子进程如果小于则会等待进程组标识符与绝对值相等的所有子进程如果等于则等待任意子进程与等价与函数的参数意义相同参数是一个位掩码可以包括个或多个标志返回值返回值与函数的返回值意义基本相同在参数包含了标志的情况下返回值会出现与类似不过提供了更多的扩展功能具体的使用方法笔者便不再介绍大家有兴趣可以自己通过查阅资料进行学习孤儿进程父进程先于子进程结束也就是意味着此时子进程变成了一个孤儿我们把这种进程就称为孤儿进程在系统当中所有的孤儿进程都自动成为进程进程号为的子进程僵尸进程进程结束之后通常需要其父进程为其收尸回收子进程占用的一些内存资源父进程通过调用或其变体等函数回收子进程资源归还给系统如果子进程先于父进程结束此时父进程还未来得及给子进程收尸那么此时子进程就变成了一个僵尸进程另外一种情况如果父进程并没有调用函数然后就退出了那么此时进程将会接管它的子进程并自动调用故而从系统中移除僵尸进程系统中存在大量的僵尸进程它们势必会填满内核进程表从而阻碍新进程的创建需要注意的是僵尸进程是无法通过信号将其杀死的即使是一击必杀信号也无法将其杀死那么这种情况下只能杀死僵尸进程的父进程或等待其父进程终止这样进程将会接管这些僵尸进程从而将它们从系统中清理掉总结孤儿进程父进程先结束爹先挂了被养父进程号为收养并被重新设置为其子进程僵尸进程子进程终止但父进程没有使用或收集其资源爹不管守护进程在后台运行不与任何终端关联的进程后台天使守护进程守护进程也称为精灵进程是运行在后台的一种特殊进程它独立于控制终端并且周期性地执行某种任务或等待处理某些事情的发生主要表现为以下两个特点长期运行系统启动开始运行除非强制终止不然直到系统关机才停止运行普通进程是用户登入或者程序运行时创建到用户注销或程序退出时终止但守护进程不受用户登录或注销的影响一直运行与终端脱离在中系统与用户交互的界面称为终端每一个从终端开始运行的进程都会依附于这个终端守护进程通常简称为一般进程名后面带有就表示它是一个守护进程列中是号表示没有控制终端也就是守护进程簇函数当子进程的工作不再是运行父进程的代码段而是运行另一个新程序的代码另一个可执行程序那么这个时候子进程可以通过函数来实现运行另一个新的程序说到这里为什么需要在子进程中执行新程序其实这个问题非常简单虽然可以直接在子进程分支编写子进程需要运行的代码但是不够灵活扩展性不够好直接将子进程需要运行的代码单独放在一个可执行文件中不是更好吗所以就出现了操作族函数中的库函数都是基于系统调用而实现的虽然参数各异但功能相同包括它们的函数原型如下所示可以将新程序加载到某一进程的内存空间运行使用新的程序替换旧的程序而进程的栈数据以及堆数据会被新程序的相应部件所替换然后从新程序的函数开始执行函数原型如下返回值调用成功将不会返回失败将返回并设置参数介绍指向需要载入当前进程空间的新程序的路径名既可以是绝对路径也可以是相对路径指定了传递给新程序的命令行参数是一个字符串数组该数组对应于函数的第二个参数且格式也与之相同是由字符串指针所组成的数组以结束对应的便是新程序自身路径名参数也是一个字符串指针数组指定了新程序的环境变量列表参数其实对应于新程序的数组同样也是以结束所指向的字符串格式为使用试列下列函数的使用并不是它真正的应用场景通常由生成的子进程对的调用最为频繁也就是子进程执行操作试列中的用法在实际的应用不常见这里只是给大家进行演示说明程序中通过调用函数来执行程序设置程序中的环境变量必须以结束成功退出后该程序也结束并不会执行这些代码对应中的打印传递过来的参数打印环境变量函数原型参数介绍指向新可执行程序的路径可以是相对和绝对路径参数列表把参数列表依次排列使用可变参数形式传递本质上也是多个字符串以结尾函数原型参数介绍指向新可执行程序的路径可以是相对和绝对路径指定了传递给新程序的命令行参数是一个字符串数组该数组对应于函数的第二个参数且格式也与之相同是由字符串指针所组成的数组以结束对应的便是新程序自身路径名和在和基础上加了一个这个其实表示的是和要求提供新程序的路径名而和则允许只提供新程序文件名系统会在由环境变量所指定的目录列表中寻找相应的可执行文件如果执行的新程序是一个命令这将很有用当然和函数也兼容相对路径和绝对路径的方式与和这两个函数在命名上加了一个这个其实表示的是环境变量意味着这两个函数可以指定自定义的环境变量列表给新程序参数与系统调用的参数相同也是字符串指针数组传参传参使用簇函数执行命令函数使用函数可以很方便地在我们的程序当中执行任意命令函数其内部的是通过调用以及这三个函数来实现它的功能函数原型返回值当参数为如果可用则返回一个非值若不可用则返回针对一些非系统该系统上可能是没有的这样就会导致不可能如果参数不为则返回值从以下的各种情况所决定如果无法创建子进程或无法获取子进程的终止状态那么返回如果子进程不能执行则的返回值就好像是子进程通过调用终止了如果所有的系统调用都成功函数会返回执行的进程的终止状态参数介绍指向需要执行的命令以字符串的形式提供譬如等使用示例将需要执行的命令通过参数传递给函数函数里调用来执行该命令函数也是用于执行命令的函数与相比能够将执行命令后得到的数据通过管道进行读出或写入函数通过创建一个管道调用产生一个子进程执行一个以运行命令来开启一个进程这个进程必须由函数关闭而不是函数函数关闭标准流等待命令执行结束然后返回的终止状态如果不能被执行则返回的终止状态与已执行一样也就是创建管道执行命令将文件流中的某些数据读出函数原型头文件补充指针相当于文件描述符作为文件句柄参数介绍是一个指向以结束的命令字符串的指针命令将被传到并使用标志将执行这个命令比如则文件指针连接到的标准输出如果是则文件指针连接到的标准输入使用示例通过调用去执行命令把结果给通过读取',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-04-30 21:18:32',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.2.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://img2.imgtp.com/2024/04/29/XJZajStb.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">Ten-zzZ</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/music/"><span> 音乐馆</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 我的装备</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://img2.imgtp.com/2024/04/29/ZLUmR1ch.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://img2.imgtp.com/2024/04/29/ZLUmR1ch.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://img2.imgtp.com/2024/04/29/jhBLTmH3.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://img2.imgtp.com/2024/04/29/jhBLTmH3.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/linux/" style="font-size: 1.05rem;">linux<sup>8</sup></a><a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/" style="font-size: 1.05rem;">嵌入式<sup>2</sup></a><a href="/tags/%E7%BA%BF%E7%A8%8B/" style="font-size: 1.05rem;">线程<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" style="font-size: 1.05rem;">网络编程<sup>1</sup></a><a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 1.05rem;">设计模式<sup>1</sup></a><a href="/tags/%E8%BF%9B%E7%A8%8B/" style="font-size: 1.05rem;">进程<sup>2</sup></a><a href="/tags/%E9%80%9A%E4%BF%A1/" style="font-size: 1.05rem;">通信<sup>1</sup></a><a href="/tags/%E9%9A%8F%E7%AC%94/" style="font-size: 1.05rem;">随笔<sup>2</sup></a><a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 1.05rem;">面试<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">五月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">8</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B/" itemprop="url">linux系统编程</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E8%BF%9B%E7%A8%8B/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>进程</span></a><a class="article-meta__tags" href="/tags/linux/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>linux</span></a></span></div></div><h1 class="post-title" itemprop="name headline">进程</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-04-30T03:18:14.043Z" title="发表于 2024-04-30 11:18:14">2024-04-30</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-04-30T13:18:32.032Z" title="更新于 2024-04-30 21:18:32">2024-04-30</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">6.4k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>24分钟</span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为新余"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>新余</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://img2.imgtp.com/2024/04/30/ZamtkUJE.jpg"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2024/04/30/%E8%BF%9B%E7%A8%8B/"><header><a class="post-meta-categories" href="/categories/linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B/" itemprop="url">linux系统编程</a><a href="/tags/%E8%BF%9B%E7%A8%8B/" tabindex="-1" itemprop="url">进程</a><a href="/tags/linux/" tabindex="-1" itemprop="url">linux</a><h1 id="CrawlerTitle" itemprop="name headline">进程</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Ten</span><time itemprop="dateCreated datePublished" datetime="2024-04-30T03:18:14.043Z" title="发表于 2024-04-30 11:18:14">2024-04-30</time><time itemprop="dateCreated datePublished" datetime="2024-04-30T13:18:32.032Z" title="更新于 2024-04-30 21:18:32">2024-04-30</time></header><h2 id="程序与进程"><a href="#程序与进程" class="headerlink" title="程序与进程"></a>程序与进程</h2><p>程序：是可执行文件，其本质是是一个文件，程序是静态的，同一个程序可以运行多次，产生多个进程</p>
<p>进程：它是程序的一次运行过程，当应用程序被加载到内存中运行之后它就称为了一个进程，进程是动态的，进程的生命周期是从程序运行到程序退出</p>
<p>父子进程：当一个进程A通过frok()函数创建出进程B，A为B的父进程，B为A的子进程</p>
<p>进程号（PID）：也称进程标识符，是一个非负整数，用于唯一标识系统下某一个进程。</p>
<ul>
<li><p>pid&#x3D;0：交换进程，pid&#x3D;1：init进程，</p>
</li>
<li><p>linux中可以使用ps -aux查看系统中的所有进程，可配合管道进行使用 ps -aux | grep xxx。</p>
</li>
<li><p>pid_t getpid(void)：该系统调用用于获取当前进程的pid。</p>
</li>
<li><p>pid_t getppid(void)：用于获取父进程的pid。</p>
</li>
</ul>
<h2 id="进程的创建"><a href="#进程的创建" class="headerlink" title="进程的创建"></a>进程的创建</h2><p>一个现有的进程可以调用 fork()函数创建一个新的进程， 调用 fork()函数的进程称为父进程，由 fork()函<br>数创建出来的进程被称为子进程（child process） ， fork()函数原型如下所示（fork()为系统调用）。</p>
<h3 id="应用场景："><a href="#应用场景：" class="headerlink" title="应用场景："></a>应用场景：</h3><ul>
<li>在诸多的应用中，创建多个进程是任务分解时行之有效的方法，譬如，某一网络服务器进程可在监听客户端请求的同时，为处理每一个请求事件而创建一个新的子进程，与此同时，服务器进程会继续监听更多的客户端连接请求。  </li>
<li>一个进程要执行不同的程序。 譬如在程序 app1 中调用 fork()函数创建了子进程，此时子进程是要<br>去执行另一个程序 app2，也就是子进程需要执行的代码是 app2 程序对应的代码，子进程将从 app2<br>程序的 main 函数开始运行。这种情况，通常在子进程从 fork()函数返回之后立即调用 exec 族函数<br>来实现，关于 exec 函数将在后面内容向大家介绍。</li>
</ul>
<h3 id="fork-："><a href="#fork-：" class="headerlink" title="fork()："></a>fork()：</h3><p>作用：用于创建一个子进程，原型如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="type">pid_t</span> <span class="title function_">fork</span><span class="params">(<span class="type">void</span>)</span>;</span><br></pre></td></tr></table></figure>

<p>理解 fork()系统调用的关键在于，完成对其调用后将存在两个进程，一个是原进程（父进程）、另一个<br>则是创建出来的子进程，并且每个进程都会从 fork()函数的返回处继续执行，会导致调用 fork()返回两次值，<br>子进程返回一个值、父进程返回一个值  。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">pid_t</span> pid;</span><br><span class="line">    pid = getpid();</span><br><span class="line"></span><br><span class="line">    fork();     <span class="comment">//创建一个子进程，子进程从这开始执行</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;pid = %d\r\n&quot;</span>,pid);     <span class="comment">//父子进程都会执行该语句</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../imgs/%E8%BF%9B%E7%A8%8B/image-20240430135622054.png" alt="image-20240430135622054"></p>
<p>fork()调用成功后，会在父进程中返回子进程的 PID，而在子进程中返回值是 0；如果调用失败，父进<br>程返回值-1，不创建子进程，并设置 errno。  </p>
<p>fork返回值总结：父子进程都会从fork()函数的返回处继续执行。</p>
<ul>
<li>父进程：返回子进程PID，调用失败返回-1</li>
<li>子进程：返回0</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">pid_t</span> pid;</span><br><span class="line">    pid = fork();</span><br><span class="line">    <span class="keyword">switch</span>(pid)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">-1</span>:</span><br><span class="line">            perror(<span class="string">&quot;fork error&quot;</span>);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;这是子进程打印的信息：父进程pid = %d，子进程pid = %d\r\n&quot;</span>,getppid(),getpid());</span><br><span class="line">            _exit(<span class="number">0</span>);   <span class="comment">//子进程使用_exit退出</span></span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;这是父进程打印的信息：父进程pid = %d，子进程pid = %d\r\n&quot;</span>,getpid(),pid);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../imgs/%E8%BF%9B%E7%A8%8B/image-20240430140932761.png" alt="image-20240430140932761"></p>
<h3 id="vfork"><a href="#vfork" class="headerlink" title="vfork()"></a>vfork()</h3><p>也是用于创建子进程，返回值与fork()一样。原型如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="type">pid_t</span> <span class="title function_">vfork</span><span class="params">(<span class="type">void</span>)</span></span><br></pre></td></tr></table></figure>

<p>vfork与fork区别：</p>
<ul>
<li>vfork直接使用父进程存储空间，不拷贝。<ul>
<li>vfork()与 fork()一样都创建了子进程，但 vfork()函数并不会将父进程的地址空间完全复制到子进程中，因为子进程会立即调用 exec（_exit） ，于是也就不会引用该地址空间的数据。不过在子进程调用 exec 或_exit 之前，它在父进程的空间中运行、 子进程共享父进程的内存。这种优化工作方式的实现提高的效率； 但如果子进程修改了父进程的数据（除了 vfork 返回值的变量）、进行了函数调用、或者没有调用 exec 或_exit 就返回将可能带来未知的结果</li>
</ul>
</li>
<li>vfork保证子进程先运行，当子进程调用exit退出后，父进程才执行。<ul>
<li>vfork()保证子进程先运行， 子进程调用 exec 之后父进程才可能被调度运行。<br>  虽然 vfork()系统调用在效率上要优于 fork()，但是 vfork()可能会导致一些难以察觉的程序 bug，所以尽量避免使用 vfork()来创建子进程，虽然 fork()在效率上并没有 vfork()高，但是现代的 Linux 系统内核已经采用了写时复制技术来实现 fork()，其效率较之于早期的 fork()实现要高出许多，除非速度绝对重要的场合，</li>
</ul>
</li>
</ul>
<h3 id="父子数据共享"><a href="#父子数据共享" class="headerlink" title="父子数据共享"></a>父子数据共享</h3><p>使用fork()创建子进程后，子进程会把父进程中的数据拷贝一份；该实验中，子进程对a进行了+10操作，但是不影响父进程中的a。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">pid_t</span> pid;</span><br><span class="line">    <span class="type">int</span> a = <span class="number">10</span>;</span><br><span class="line">    pid = fork();										<span class="comment">//fork创建子进程</span></span><br><span class="line">    <span class="keyword">switch</span>(pid)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">-1</span>:</span><br><span class="line">            perror(<span class="string">&quot;fork error&quot;</span>);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            a+=<span class="number">10</span>;										<span class="comment">//子进程中改变数据</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;我是子进程: a = %d\r\n&quot;</span>,a);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;我是父进程: a = %d\r\n&quot;</span>,a);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../imgs/%E8%BF%9B%E7%A8%8B/image-20240430150651901.png" alt="image-20240430150651901"></p>
<p>使用vfork()创建子进程，子进程不会拷贝父进程中的数据，而是直接使用父进程中的数据。子进程中更改数据也影响父进程中的数据。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">pid_t</span> pid;</span><br><span class="line">    <span class="type">int</span> a = <span class="number">10</span>;</span><br><span class="line">    pid = vfork();			<span class="comment">//vfork创建子进程</span></span><br><span class="line">    <span class="keyword">switch</span>(pid)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">-1</span>:</span><br><span class="line">            perror(<span class="string">&quot;fork error&quot;</span>);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            a+=<span class="number">10</span>;			<span class="comment">//子进程中改变数据</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;我是子进程: a = %d\r\n&quot;</span>,a);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;我是父进程: a = %d\r\n&quot;</span>,a);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../imgs/%E8%BF%9B%E7%A8%8B/image-20240430151039286.png" alt="image-20240430151039286"></p>
<h3 id="父子竞争"><a href="#父子竞争" class="headerlink" title="父子竞争"></a>父子竞争</h3><p>调用 fork()之后，子进程成为了一个独立的进程，可被系统调度运行，而父进程也继续被系统调度运行，<br>那么谁先访问cpu呢？答案是不确定的，父子进程运行顺序不确定。</p>
<p>从测试结果可知，虽然绝大部分情况下，父进程会先于子进程被执行，但是并不排除子进程先于父进程<br>被执行的可能性。   </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">pid_t</span> pid;</span><br><span class="line">    pid = fork();</span><br><span class="line">    <span class="keyword">switch</span>(pid)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">-1</span>:</span><br><span class="line">            perror(<span class="string">&quot;fork error&quot;</span>);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;我是子进程\r\n&quot;</span>);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;我是父进程\r\n&quot;</span>);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../imgs/%E8%BF%9B%E7%A8%8B/image-20240430145640780.png" alt="image-20240430145640780"></p>
<h2 id="进程退出"><a href="#进程退出" class="headerlink" title="进程退出"></a>进程退出</h2><p>进程退出包括正常退出和异常退出：</p>
<p>正常退出</p>
<ul>
<li>main()函数中通过 return 语句返回来终止进程；</li>
<li>应用程序中调用 exit()函数终止进程；</li>
<li>应用程序中调用exit()或_Exit()终止进程；  </li>
<li>补充：进程中最后一个线程返回，进程也会退出。最后一个线程调用pthrea_exit();</li>
</ul>
<p>异常退出</p>
<ul>
<li><p>应用程序中调用 abort()函数终止进程；</p>
</li>
<li><p>进程接收到一个信号，譬如 SIGKILL 信号。</p>
</li>
</ul>
<p>一<em>般使用 exit()库函数而非exit()系统调用 ，原因在于 exit()最终也会通过exit()终止进程，但在此之前，它将会完成一些其它的工作， exit()函数会执行的动作如下</em>  ：</p>
<ol>
<li>如果程序中注册了进程终止处理函数，那么会调用终止处理函数。  </li>
<li>刷新 stdio 流缓冲区 。</li>
<li>执行_exit()系统调用。</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">exit</span><span class="params">(<span class="type">int</span> status)</span>;		<span class="comment">//传入状态码，用于标识为啥退出，0表示正常退出，-1表示异常退出</span></span><br></pre></td></tr></table></figure>





<h2 id="监视子进程"><a href="#监视子进程" class="headerlink" title="监视子进程"></a>监视子进程</h2><p>就是等待子进程退出。对于许多需要创建子进程的进程来说，有时设计需要监视子进程的终止时间以及终止时的一些状态信息，在某些设计需求下这是很有必要的。  </p>
<h3 id="wait"><a href="#wait" class="headerlink" title="wait()"></a>wait()</h3><p>系统调用 wait()可以等待进程的任一子进程终止，同时获取子进程的终止状态信息，wait()函数的作用除了获取子进程的终止状态信息之外，更重要的一点，就是回收子进程的一些资源，俗称为子进程“收尸” ，  其函数原型如下所示：  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="type">pid_t</span> <span class="title function_">wait</span><span class="params">(<span class="type">int</span> *status)</span>;</span><br></pre></td></tr></table></figure>

<p>参数介绍：</p>
<ul>
<li>status： 参数 status 用于存放子进程终止时的状态信息，参数 status 可以为 NULL，表示不接收子进程<br>终止时的状态信息。</li>
<li>返回值： 若成功则返回终止的子进程对应的进程号；失败则返回-1。</li>
</ul>
<p>系统调用 wait()将执行如下动作：  一次 wait()调用只能处理一次。  </p>
<ul>
<li><p>调用 wait()函数，如果其所有子进程都还在运行，则 wait()会一直阻塞等待，直到某一个子进程终<br>止；</p>
</li>
<li><p>如果进程调用 wait()，但是该进程并没有子进程， 也就意味着该进程并没有需要等待的子进程， 那 么 wait()将返回错误，也就是返回-1、并且会将 errno 设置为 ECHILD。</p>
</li>
<li><p>如果进程调用 wait()之前， 它的子进程当中已经有一个或多个子进程已经终止了，那么调用 wait()<br>也不会阻塞，而是会立即替该子进程“收尸” 、处理它的“后事”   。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> status;</span><br><span class="line">    <span class="type">int</span> ret;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="comment">/* 循环创建 3 个子进程 */</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= <span class="number">3</span>; i++) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">switch</span> (fork()) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">-1</span>:</span><br><span class="line">                perror(<span class="string">&quot;fork error&quot;</span>);</span><br><span class="line">                <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                <span class="comment">/* 子进程 */</span></span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;子进程&lt;%d&gt;被创建\n&quot;</span>, getpid());</span><br><span class="line">                sleep(i);</span><br><span class="line">                _exit(i);</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="comment">/* 父进程 */</span></span><br><span class="line">                <span class="keyword">break</span>;      <span class="comment">//跳出switch</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    sleep(<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;~~~~~~~~~~~~~~\n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= <span class="number">3</span>; i++) </span><br><span class="line">    &#123;</span><br><span class="line">        ret = wait(&amp;status);</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">-1</span> == ret) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (ECHILD == errno) </span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;没有需要等待回收的子进程\n&quot;</span>);</span><br><span class="line">                <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> </span><br><span class="line">            &#123;</span><br><span class="line">                perror(<span class="string">&quot;wait error&quot;</span>);</span><br><span class="line">                <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;回收子进程&lt;%d&gt;, 终止状态&lt;%d&gt;\n&quot;</span>, ret,</span><br><span class="line">        WEXITSTATUS(status));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​	<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../imgs/%E8%BF%9B%E7%A8%8B/image-20240430163350668.png" alt="image-20240430163350668"></p>
</li>
</ul>
<h3 id="waitpid"><a href="#waitpid" class="headerlink" title="waitpid()"></a>waitpid()</h3><p>用 wait()系统调用存在着一些限制，这些限制包括如下：</p>
<ul>
<li>如果父进程创建了多个子进程，使用 wait()将无法等待某个特定的子进程的完成，只能按照顺序等待下一个子进程的终止，一个一个来、谁先终止就先处理谁；</li>
<li>如果子进程没有终止，正在运行，那么 wait()总是保持阻塞，有时我们希望执行非阻塞等待，是否有子进程终止，通过判断即可得知；</li>
<li>使用 wait()只能发现那些被终止的子进程，对于子进程因某个信号（譬如 SIGSTOP 信号）而停止（注意，这里停止指的暂停运行），或是已停止的子进程收到 SIGCONT 信号后恢复执行的情况就无能为力了</li>
</ul>
<p>函数原型：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="type">pid_t</span> <span class="title function_">waitpid</span><span class="params">(<span class="type">pid_t</span> pid, <span class="type">int</span> *status, <span class="type">int</span> options)</span>;</span><br></pre></td></tr></table></figure>

<p>参数介绍：</p>
<ul>
<li>pid： 参数 pid 用于表示需要等待的某个具体子进程，关于参数 pid 的取值范围如下：<ul>
<li>如果 pid 大于 0，表示等待进程号为 pid 的子进程；</li>
<li>如果 pid 等于 0，则等待与调用进程（父进程）同一个进程组的所有子进程；</li>
<li>如果 pid 小于-1，则会等待进程组标识符与 pid 绝对值相等的所有子进程；</li>
<li>如果 pid 等于-1，则等待任意子进程。 wait(&amp;status)与 waitpid(-1, &amp;status, 0)等价。</li>
</ul>
</li>
<li>status： 与 wait()函数的 status 参数意义相同。</li>
<li>options： 参数 options 是一个位掩码，可以包括 0 个或多个标志：  WNOHANG；WUNTRACED  ；WCONTINUED</li>
<li>返回值： 返回值与 wait()函数的返回值意义基本相同，在参数 options 包含了 WNOHANG 标志的情况<br>下，返回值会出现 0。</li>
</ul>
<h3 id="waitid"><a href="#waitid" class="headerlink" title="waitid()"></a>waitid()</h3><p>waitid()与 waitpid()类似，不过 waitid()提供了更多的扩展功能，具体的使用方法笔者便不再介绍，大家有兴趣可以自己通过 查阅资料进行学习  。</p>
<h3 id="孤儿进程"><a href="#孤儿进程" class="headerlink" title="孤儿进程"></a>孤儿进程</h3><p>父进程先于子进程结束，也就是意味着，此时子进程变成了一个“孤儿”，我们把这种进程就称为孤儿<br>进程。   </p>
<p>在 Linux 系统当中，所有的孤儿进程都自动成为 init 进程（进程号为 1）的子进程。</p>
<h3 id="僵尸进程"><a href="#僵尸进程" class="headerlink" title="僵尸进程"></a>僵尸进程</h3><p>进程结束之后，通常需要其父进程为其“收尸”，回收子进程占用的一些内存资源，父进程通过调用<br>wait()（或其变体 waitpid()、 waitid()等）函数回收子进程资源，归还给系统  。</p>
<p>如果子进程先于父进程结束，此时父进程还未来得及给子进程“收尸”，那么此时子进程就变成了一个<br>僵尸进程。   </p>
<p>另外一种情况，如果父进程并没有调用 wait()函数然后就退出了，那么此时 init 进程将会接管它的子进程并<br>自动调用 wait()， 故而从系统中移除僵尸进程。  </p>
<p>系统中存在大量的僵尸进程，它们势必会填满内核进程表，从而阻碍新进程的创建。  </p>
<p>需要注意的是，僵尸进程是无法通过信号将其杀死的，即使是“一击必杀”信号 SIGKILL 也无法将其杀死，那么这种情况下，只能杀死僵尸进程的父进程（或等待其父进程终止），这样 init 进程将会接管这些僵尸进程，从而将它们从系统中清理掉！  </p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ol>
<li><strong>孤儿进程：</strong>父进程先结束<strong>【爹先挂了】，</strong>被<strong>init养父(进程号为1)</strong> 收养,并被重新设置为其子进程</li>
<li><strong>僵尸进程：</strong>子进程终止，但父进程没有使用wait或waitpid收集其资源<strong>【爹不管】</strong></li>
<li><strong>守护进程：</strong>在后台运行，不与任何终端关联的进程<strong>【后台天使】</strong></li>
</ol>
<h2 id="守护进程"><a href="#守护进程" class="headerlink" title="守护进程"></a>守护进程</h2><p>守护进程（Daemon） 也称为精灵进程，是运行在后台的一种特殊进程，它独立于控制终端并且周期性<br>地执行某种任务或等待处理某些事情的发生， 主要表现为以下两个特点：  </p>
<ul>
<li>长期运行。系统启动开始运行，除非强制终止，不然直到系统关机才停止运行。普通进程是用户登入或者程序运行时创建，到用户注销或程序退出时终止。但守护进程不受用户登录或注销的影响，一直运行。</li>
<li>与终端脱离。在 Linux 中，系统与用户交互的界面称为终端，每一个从终端开始运行的进程都<br>会依附于这个终端  。</li>
</ul>
<p>守护进程 Daemon，通常简称为 d，一般进程名后面带有 d 就表示它是一个守护进程。  TTY列中是？号，表示没有控制终端，也就是守护进程。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../imgs/%E8%BF%9B%E7%A8%8B/image-20240430202905455.png" alt="image-20240430202905455"></p>
<h2 id="exec簇函数"><a href="#exec簇函数" class="headerlink" title="exec簇函数"></a>exec簇函数</h2><p>当子进程的工作不再是运行父进程的代码段，而是运行另一个新程序的代码（另一个可执行程序），那么这个时候子进程可以通过 exec 函数来实现运行另一个新的程序  。</p>
<p>说到这里，为什么需要在子进程中执行新程序？其实这个问题非常简单，虽然可以直接在子进程分支编写子进程需要运行的代码，但是不够灵活，扩展性不够好，直接将子进程需要运行的代码单独放在一个可执行文件中不是更好吗， 所以就出现了 exec 操作 。</p>
<p>exec 族函数中的库函数都是基于系统调用 execve()而实现的，虽然参数各异、但功能相同， 包括： execl()、 execlp()、 execle()、 execv()、execvp()、 execvpe()， 它们的函数原型如下所示：  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="keyword">extern</span> <span class="type">char</span> **environ;</span><br><span class="line"><span class="type">int</span> <span class="title function_">execl</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *path, <span class="type">const</span> <span class="type">char</span> *arg, ... <span class="comment">/* (char *) NULL */</span>)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">execlp</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *file, <span class="type">const</span> <span class="type">char</span> *arg, ... <span class="comment">/* (char *) NULL */</span>)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">execle</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *path, <span class="type">const</span> <span class="type">char</span> *arg, ... <span class="comment">/*, (char *) NULL, char * const envp[] */</span>)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">execv</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *path, <span class="type">char</span> *<span class="type">const</span> argv[])</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">execvp</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *file, <span class="type">char</span> *<span class="type">const</span> argv[])</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">execvpe</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *file, <span class="type">char</span> *<span class="type">const</span> argv[], <span class="type">char</span> *<span class="type">const</span> envp[])</span>;</span><br></pre></td></tr></table></figure>

<h3 id="execve"><a href="#execve" class="headerlink" title="execve()"></a>execve()</h3><p> execve()可以将新程序加载到某一进程的内存空间运行，使用新的程序替换旧的程序，而进程的栈、数据、以及堆数据会被新程序的相应部件所替换，然后从新程序的 main()函数开始执行。 函数原型如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">execve</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *filename, <span class="type">char</span> *<span class="type">const</span> argv[], <span class="type">char</span> *<span class="type">const</span> envp[])</span>; </span><br></pre></td></tr></table></figure>

<p>返回值： execve 调用成功将不会返回；失败将返回-1，并设置 errno。  </p>
<p>参数介绍：</p>
<ul>
<li>filename： 指向需要载入当前进程空间的新程序的路径名，既可以是绝对路径、也可以是相对路径。  </li>
<li>argv： 指定了传递给新程序的命令行参数。是一个字符串数组， 该数组对应于 main(int argc, char*argv[])函数的第二个参数 argv，且格式也与之相同，是由字符串指针所组成的数组，以 NULL 结束。argv[0]对应的便是新程序自身路径名。  </li>
<li>envp： 参数 envp 也是一个字符串指针数组， 指定了新程序的环境变量列表， 参数 envp 其实对应于新程序的 environ 数组，同样也是以 NULL 结束，所指向的字符串格式为 name&#x3D;value。</li>
</ul>
<p>使用试列：</p>
<p>下列execve()函数的使用并不是它真正的应用场景， 通常由 fork()生成的子进程对 execve()的调用最为频繁，也就是子进程执行 exec 操作； 试列 中的 execve 用法在实际的应用不常见，这里只是给大家进行演示说明。 </p>
<p>testAPP程序中通过调用execve函数来执行newAPP程序</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">							<span class="comment">/*testAPP.c*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> *arg_arr[<span class="number">5</span>];</span><br><span class="line">    <span class="type">char</span> *env_arr[<span class="number">5</span>] = &#123;<span class="string">&quot;NAME=app&quot;</span>, <span class="string">&quot;AGE=25&quot;</span>,</span><br><span class="line">    <span class="string">&quot;SEX=man&quot;</span>, <span class="literal">NULL</span>&#125;;		<span class="comment">//设置newAPP程序中的环境变量</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="number">2</span> &gt; argc)</span><br><span class="line">    	<span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    arg_arr[<span class="number">0</span>] = argv[<span class="number">1</span>];</span><br><span class="line">    arg_arr[<span class="number">1</span>] = <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">    arg_arr[<span class="number">2</span>] = <span class="string">&quot;World&quot;</span>;</span><br><span class="line">    arg_arr[<span class="number">3</span>] = <span class="literal">NULL</span>;		<span class="comment">//必须以NULL结束</span></span><br><span class="line">    execve(argv[<span class="number">1</span>], arg_arr, env_arr);</span><br><span class="line">    </span><br><span class="line">    perror(<span class="string">&quot;execve error&quot;</span>);		<span class="comment">//execve成功退出后，该程序也结束，并不会执行这些代码</span></span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">								<span class="comment">/*newAPP.c*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="keyword">extern</span> <span class="type">char</span> **environ;			<span class="comment">//对应testAPP中的env_arr</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> **ep = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="type">int</span> j;</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; argc; j++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;argv[%d]: %s\n&quot;</span>, j, argv[j]);	<span class="comment">//打印传递过来的参数</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;env:&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (ep = environ; *ep != <span class="literal">NULL</span>; ep++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot; %s\n&quot;</span>, *ep);		<span class="comment">//打印环境变量</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>



<h3 id="execl"><a href="#execl" class="headerlink" title="execl()"></a>execl()</h3><p>函数原型：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">execl</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *path, <span class="type">const</span> <span class="type">char</span> *arg, ... )</span>;</span><br></pre></td></tr></table></figure>

<p>参数介绍：</p>
<ul>
<li><p>path：指向新可执行程序的路径，可以是相对和绝对路径</p>
</li>
<li><p>参数列表：把参数列表依次排列，使用可变参数形式传递，本质上也是多个字符串，以 NULL 结尾。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execl(<span class="string">&quot;./newApp&quot;</span>, <span class="string">&quot;./newApp&quot;</span>, <span class="string">&quot;Hello&quot;</span>, <span class="string">&quot;World&quot;</span>, <span class="literal">NULL</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="execv"><a href="#execv" class="headerlink" title="execv"></a>execv</h3><p>函数原型：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">execv</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *path, <span class="type">char</span> *<span class="type">const</span> argv[])</span>;</span><br></pre></td></tr></table></figure>

<p>参数介绍：</p>
<ul>
<li><p>path：指向新可执行程序的路径，可以是相对和绝对路径。</p>
</li>
<li><p>argv：指定了传递给新程序的命令行参数。是一个字符串数组， 该数组对应于 main(int argc, char*argv[])函数的第二个参数 argv，且格式也与之相同，是由字符串指针所组成的数组，以 NULL 结束。argv[0]对应的便是新程序自身路径名。  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *arg_arr[<span class="number">5</span>];</span><br><span class="line">arg_arr[<span class="number">0</span>] = <span class="string">&quot;./newApp&quot;</span>;</span><br><span class="line">arg_arr[<span class="number">1</span>] = <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">arg_arr[<span class="number">2</span>] = <span class="string">&quot;World&quot;</span>;</span><br><span class="line">arg_arr[<span class="number">3</span>] = <span class="literal">NULL</span>;</span><br><span class="line">execv(<span class="string">&quot;./newApp&quot;</span>, arg_arr);</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="execlp-execvp"><a href="#execlp-execvp" class="headerlink" title="execlp()execvp()"></a>execlp()execvp()</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">execlp</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *file, <span class="type">const</span> <span class="type">char</span> *arg, ... )</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">execvp</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *file, <span class="type">char</span> *<span class="type">const</span> argv[])</span>;</span><br></pre></td></tr></table></figure>

<p>execlp()和 execvp()在 execl()和 execv()基础上加了一个 p，这个 p 其实表示的是 PATH。execl()和execv()要求提供新程序的路径名，而 execlp()和 execvp()则允许只提供新程序文件名，系统会在由<br>环境变量 PATH 所指定的目录列表中寻找相应的可执行文件，如果执行的新程序是一个 Linux 命令，这将很有用； 当然， execlp()和 execvp()函数也兼容相对路径和绝对路径的方式。  </p>
<h3 id="execle-与execvpe"><a href="#execle-与execvpe" class="headerlink" title="execle()与execvpe()"></a>execle()与execvpe()</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">execle</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *path, <span class="type">const</span> <span class="type">char</span> *arg, ... )</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">execvpe</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *file, <span class="type">char</span> *<span class="type">const</span> argv[], <span class="type">char</span> *<span class="type">const</span> envp[])</span>;</span><br></pre></td></tr></table></figure>

<p>execle()和 execvpe()这两个函数在命名上加了一个 e，这个 e 其实表示的是 environment 环境变量，<br>意味着这两个函数可以指定自定义的环境变量列表给新程序， 参数envp与系统调用execve()的envp<br>参数相同，也是字符串指针数组  。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//execvpe 传参</span></span><br><span class="line"><span class="type">char</span> *env_arr[<span class="number">5</span>] = &#123;<span class="string">&quot;NAME=app&quot;</span>, <span class="string">&quot;AGE=25&quot;</span>,<span class="string">&quot;SEX=man&quot;</span>, <span class="literal">NULL</span>&#125;;</span><br><span class="line"><span class="type">char</span> *arg_arr[<span class="number">5</span>];</span><br><span class="line">arg_arr[<span class="number">0</span>] = <span class="string">&quot;./newApp&quot;</span>;</span><br><span class="line">arg_arr[<span class="number">1</span>] = <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">arg_arr[<span class="number">2</span>] = <span class="string">&quot;World&quot;</span>;</span><br><span class="line">arg_arr[<span class="number">3</span>] = <span class="literal">NULL</span>;</span><br><span class="line">execvpe(<span class="string">&quot;./newApp&quot;</span>, arg_arr, env_arr);</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// execle 传参</span></span><br><span class="line">execle(<span class="string">&quot;./newApp&quot;</span>, <span class="string">&quot;./newApp&quot;</span>, <span class="string">&quot;Hello&quot;</span>, <span class="string">&quot;World&quot;</span>, <span class="literal">NULL</span>, env_arr);</span><br></pre></td></tr></table></figure>

<h3 id="使用exec簇函数执行ls命令"><a href="#使用exec簇函数执行ls命令" class="headerlink" title="使用exec簇函数执行ls命令"></a>使用exec簇函数执行ls命令</h3><h4 id="execl-1"><a href="#execl-1" class="headerlink" title="execl"></a>execl</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    execl(<span class="string">&quot;/bin/ls&quot;</span>, <span class="string">&quot;ls&quot;</span>, <span class="string">&quot;-a&quot;</span>, <span class="string">&quot;-l&quot;</span>, <span class="literal">NULL</span>);</span><br><span class="line">    perror(<span class="string">&quot;execl error&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="execv-1"><a href="#execv-1" class="headerlink" title="execv"></a>execv</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> *arg_arr[<span class="number">5</span>];</span><br><span class="line">    arg_arr[<span class="number">0</span>] = <span class="string">&quot;ls&quot;</span>;</span><br><span class="line">    arg_arr[<span class="number">1</span>] = <span class="string">&quot;-a&quot;</span>;</span><br><span class="line">    arg_arr[<span class="number">2</span>] = <span class="string">&quot;-l&quot;</span>;</span><br><span class="line">    arg_arr[<span class="number">3</span>] = <span class="literal">NULL</span>;</span><br><span class="line">    execv(<span class="string">&quot;/bin/ls&quot;</span>, arg_arr);</span><br><span class="line">    perror(<span class="string">&quot;execv error&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="execlp"><a href="#execlp" class="headerlink" title="execlp"></a>execlp</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    execlp(<span class="string">&quot;ls&quot;</span>, <span class="string">&quot;ls&quot;</span>, <span class="string">&quot;-a&quot;</span>, <span class="string">&quot;-l&quot;</span>, <span class="literal">NULL</span>);</span><br><span class="line">    perror(<span class="string">&quot;execlp error&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="execvp"><a href="#execvp" class="headerlink" title="execvp"></a>execvp</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> *arg_arr[<span class="number">5</span>];</span><br><span class="line">    arg_arr[<span class="number">0</span>] = <span class="string">&quot;ls&quot;</span>;</span><br><span class="line">    arg_arr[<span class="number">1</span>] = <span class="string">&quot;-a&quot;</span>;</span><br><span class="line">    arg_arr[<span class="number">2</span>] = <span class="string">&quot;-l&quot;</span>;</span><br><span class="line">    arg_arr[<span class="number">3</span>] = <span class="literal">NULL</span>;</span><br><span class="line">    execvp(<span class="string">&quot;ls&quot;</span>, arg_arr);</span><br><span class="line">    perror(<span class="string">&quot;execvp error&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="execle"><a href="#execle" class="headerlink" title="execle"></a>execle</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="keyword">extern</span> <span class="type">char</span> **environ;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    execle(<span class="string">&quot;/bin/ls&quot;</span>, <span class="string">&quot;ls&quot;</span>, <span class="string">&quot;-a&quot;</span>, <span class="string">&quot;-l&quot;</span>, <span class="literal">NULL</span>, environ);</span><br><span class="line">    perror(<span class="string">&quot;execle error&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="execvpe"><a href="#execvpe" class="headerlink" title="execvpe"></a>execvpe</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="keyword">extern</span> <span class="type">char</span> **environ;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> *arg_arr[<span class="number">5</span>];</span><br><span class="line">    arg_arr[<span class="number">0</span>] = <span class="string">&quot;ls&quot;</span>;</span><br><span class="line">    arg_arr[<span class="number">1</span>] = <span class="string">&quot;-a&quot;</span>;</span><br><span class="line">    arg_arr[<span class="number">2</span>] = <span class="string">&quot;-l&quot;</span>;</span><br><span class="line">    arg_arr[<span class="number">3</span>] = <span class="literal">NULL</span>;</span><br><span class="line">    execvpe(<span class="string">&quot;ls&quot;</span>, arg_arr, environ);</span><br><span class="line">    perror(<span class="string">&quot;execvpe error&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../imgs/%E8%BF%9B%E7%A8%8B/image-20240430194005434.png"></p>
<h2 id="system函数"><a href="#system函数" class="headerlink" title="system函数"></a>system函数</h2><p>使用 system()函数可以很方便地在我们的程序当中执行任意 shell 命令  。system()函数其内部的是通过调用 fork()、execl()以及 waitpid()这三个函数来实现它的功能。</p>
<p>函数原型：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">system</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *command)</span>;</span><br></pre></td></tr></table></figure>

<p>返回值：</p>
<ul>
<li><p>当参数 command 为 NULL， 如果 shell 可用则返回一个非 0 值，若不可用则返回 0；针对一些非<br>UNIX 系统，该系统上可能是没有 shell 的，这样就会导致 shell 不可能；如果 command 参数不为<br>NULL，则返回值从以下的各种情况所决定。</p>
</li>
<li><p>如果无法创建子进程或无法获取子进程的终止状态，那么 system()返回-1；</p>
</li>
<li><p>如果子进程不能执行 shell，则 system()的返回值就好像是子进程通过调用_exit(127)终止了；</p>
</li>
<li><p>如果所有的系统调用都成功， system()函数会返回执行 command 的 shell 进程的终止状态。</p>
</li>
</ul>
<p>参数介绍：</p>
<ul>
<li>command： 指向需要执行的 shell 命令，以字符串的形式提供，譬如”ls -al”、 “echo<br>HelloWorld”等  。</li>
</ul>
<p>使用示例：将需要执行的命令通过参数传递给main函数，main函数里调用system来执行该命令。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> ret;</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">2</span> &gt; argc)</span><br><span class="line">    	<span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    ret = system(argv[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fputs</span>(<span class="string">&quot;system error.\n&quot;</span>, <span class="built_in">stderr</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (WIFEXITED(ret) &amp;&amp; (<span class="number">127</span> == WEXITSTATUS(ret)))</span><br><span class="line">        	<span class="built_in">fputs</span>(<span class="string">&quot;could not invoke shell.\n&quot;</span>, <span class="built_in">stderr</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../imgs/%E8%BF%9B%E7%A8%8B/image-20240430195402145.png" alt="image-20240430195402145"></p>
<h2 id="popen函数"><a href="#popen函数" class="headerlink" title="popen函数"></a>popen函数</h2><p>也是用于执行shell命令的函数，与system相比，popen能够将执行命令后得到的数据通过管道进行读出或写入。</p>
<p>popen() 函数通过创建一个管道，调用 fork 产生一个子进程，执行一个 shell 以运行命令来开启一个进程。</p>
<p>这个进程必须由 pclose() 函数关闭，而不是 fclose() 函数。pclose() 函数关闭标准 I&#x2F;O 流，等待命令执行结束，然后返回 shell 的终止状态。如果 shell 不能被执行，则 pclose() 返回的终止状态与 shell 已执行 exit 一样。也就是，popen创建管道，执行shell命令将文件流中的某些数据读出。</p>
<p>函数原型：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span><span class="comment">//头文件</span></span></span><br><span class="line">FILE *<span class="title function_">popen</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *command, <span class="type">const</span> <span class="type">char</span> *type)</span>;</span><br></pre></td></tr></table></figure>

<p>补充：FILE指针，相当于文件描述符fd，作为文件句柄。</p>
<p>参数介绍：</p>
<ul>
<li>command：是一个指向以 NULL 结束的 shell 命令字符串的指针。命令将被传到 bin&#x2F;sh 并使用 -c 标志，shell 将执行这个命令，比如sh -c ls。</li>
<li>type：“r” 则文件指针连接到 command 的标准输出；如果 type 是 “w” 则文件指针连接到 command 的标准输入。</li>
</ul>
<p>使用示例：通过调用popen去执行ls -l命令，把结果给fp，通过fread读取</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc ,<span class="type">char</span> **argv)</span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="type">char</span> ret[<span class="number">1024</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	FILE *fp;</span><br><span class="line">    </span><br><span class="line">	fp = popen(<span class="string">&quot;ls -l&quot;</span>,<span class="string">&quot;r&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//size_t fwrite(const void *ptr, size_t size, size_t nmemb,FILE *stream);</span></span><br><span class="line">	<span class="type">int</span> nread = fread(ret,<span class="number">1</span>,<span class="number">1024</span>,fp);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;read ret %d byte, %s\n&quot;</span>,nread,ret);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../imgs/%E8%BF%9B%E7%A8%8B/image-20240430201934698.png" alt="image-20240430201934698"></p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/29/XJZajStb.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/29/XJZajStb.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">Ten</div><div class="post-copyright__author_desc">记得给自己磕头</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2024/04/30/%E8%BF%9B%E7%A8%8B/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2024/04/30/%E8%BF%9B%E7%A8%8B/')">进程</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://img2.imgtp.com/2024/04/29/ZLUmR1ch.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/29/ZLUmR1ch.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://img2.imgtp.com/2024/04/29/jhBLTmH3.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/29/jhBLTmH3.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2024/04/30/%E8%BF%9B%E7%A8%8B/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=进程&amp;url=http://example.com/2024/04/30/%E8%BF%9B%E7%A8%8B/&amp;pic=https://img2.imgtp.com/2024/04/30/ZamtkUJE.jpg" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Ten-zzZ</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E8%BF%9B%E7%A8%8B/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>进程<span class="tagsPageCount">2</span></a><a class="post-meta__box__tags" href="/tags/linux/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>linux<span class="tagsPageCount">8</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://img2.imgtp.com/2024/05/05/Bg6p4Ceu.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/04/29/Socket%E7%BC%96%E7%A8%8B/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/29/aStIRPSU.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Socket编程</div></div></a></div><div class="next-post pull-right"><a href="/2024/04/30/%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/30/9GnvXoDg.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">进程间通信</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2024/05/04/Linux%E7%BA%BF%E7%A8%8B/" title="Linux线程"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/05/05/Bg6p4Ceu.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-05-04</div><div class="title">Linux线程</div></div></a></div><div><a href="/2024/05/02/Makefile/" title="Makefile"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/05/02/96JZQtZT.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-05-02</div><div class="title">Makefile</div></div></a></div><div><a href="/2024/04/29/Socket%E7%BC%96%E7%A8%8B/" title="Socket编程"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/29/aStIRPSU.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-04-29</div><div class="title">Socket编程</div></div></a></div><div><a href="/2024/05/03/%E5%B5%8C%E5%85%A5%E5%BC%8FLinux%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%9E%84%E5%BB%BA/" title="嵌入式Linux系统的构建"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/05/03/yIu4n2xM.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-05-03</div><div class="title">嵌入式Linux系统的构建</div></div></a></div><div><a href="/2024/05/02/%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E5%B7%A5%E5%85%B7%E9%93%BE%E9%85%8D%E7%BD%AE/" title="交叉编译工具链配置"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/05/02/1T6KlZGz.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-05-02</div><div class="title">交叉编译工具链配置</div></div></a></div><div><a href="/2024/05/03/%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5/" title="线程同步"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="//img2.imgtp.com/2024/05/05/5xd3Cvv5.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-05-03</div><div class="title">线程同步</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/29/XJZajStb.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">欢迎来到我的嵌入式学习笔记！这里是我作为一个初学者的探索记录，我们一起从零开始，一步步解开嵌入式的神秘面纱。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">Ten</h1><div class="author-info__desc">记得给自己磕头</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/Ten-zzZ" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/352659041" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E4%B8%8E%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.</span> <span class="toc-text">程序与进程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="toc-number">2.</span> <span class="toc-text">进程的创建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%EF%BC%9A"><span class="toc-number">2.1.</span> <span class="toc-text">应用场景：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#fork-%EF%BC%9A"><span class="toc-number">2.2.</span> <span class="toc-text">fork()：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vfork"><span class="toc-number">2.3.</span> <span class="toc-text">vfork()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%88%B6%E5%AD%90%E6%95%B0%E6%8D%AE%E5%85%B1%E4%BA%AB"><span class="toc-number">2.4.</span> <span class="toc-text">父子数据共享</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%88%B6%E5%AD%90%E7%AB%9E%E4%BA%89"><span class="toc-number">2.5.</span> <span class="toc-text">父子竞争</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E9%80%80%E5%87%BA"><span class="toc-number">3.</span> <span class="toc-text">进程退出</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%91%E8%A7%86%E5%AD%90%E8%BF%9B%E7%A8%8B"><span class="toc-number">4.</span> <span class="toc-text">监视子进程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#wait"><span class="toc-number">4.1.</span> <span class="toc-text">wait()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#waitpid"><span class="toc-number">4.2.</span> <span class="toc-text">waitpid()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#waitid"><span class="toc-number">4.3.</span> <span class="toc-text">waitid()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%A4%E5%84%BF%E8%BF%9B%E7%A8%8B"><span class="toc-number">4.4.</span> <span class="toc-text">孤儿进程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%83%B5%E5%B0%B8%E8%BF%9B%E7%A8%8B"><span class="toc-number">4.5.</span> <span class="toc-text">僵尸进程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">4.6.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B"><span class="toc-number">5.</span> <span class="toc-text">守护进程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#exec%E7%B0%87%E5%87%BD%E6%95%B0"><span class="toc-number">6.</span> <span class="toc-text">exec簇函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#execve"><span class="toc-number">6.1.</span> <span class="toc-text">execve()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#execl"><span class="toc-number">6.2.</span> <span class="toc-text">execl()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#execv"><span class="toc-number">6.3.</span> <span class="toc-text">execv</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#execlp-execvp"><span class="toc-number">6.4.</span> <span class="toc-text">execlp()execvp()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#execle-%E4%B8%8Eexecvpe"><span class="toc-number">6.5.</span> <span class="toc-text">execle()与execvpe()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8exec%E7%B0%87%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8Cls%E5%91%BD%E4%BB%A4"><span class="toc-number">6.6.</span> <span class="toc-text">使用exec簇函数执行ls命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#execl-1"><span class="toc-number">6.6.1.</span> <span class="toc-text">execl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#execv-1"><span class="toc-number">6.6.2.</span> <span class="toc-text">execv</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#execlp"><span class="toc-number">6.6.3.</span> <span class="toc-text">execlp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#execvp"><span class="toc-number">6.6.4.</span> <span class="toc-text">execvp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#execle"><span class="toc-number">6.6.5.</span> <span class="toc-text">execle</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#execvpe"><span class="toc-number">6.6.6.</span> <span class="toc-text">execvpe</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#system%E5%87%BD%E6%95%B0"><span class="toc-number">7.</span> <span class="toc-text">system函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#popen%E5%87%BD%E6%95%B0"><span class="toc-number">8.</span> <span class="toc-text">popen函数</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/05/04/Linux%E7%BA%BF%E7%A8%8B/" title="Linux线程"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/05/05/Bg6p4Ceu.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux线程"/></a><div class="content"><a class="title" href="/2024/05/04/Linux%E7%BA%BF%E7%A8%8B/" title="Linux线程">Linux线程</a><time datetime="2024-05-04T08:35:39.000Z" title="发表于 2024-05-04 16:35:39">2024-05-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/04/%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F%E6%A8%A1%E6%9D%BF/" title="简单工厂模式"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/05/08/MIkSgHhh.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="简单工厂模式"/></a><div class="content"><a class="title" href="/2024/05/04/%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F%E6%A8%A1%E6%9D%BF/" title="简单工厂模式">简单工厂模式</a><time datetime="2024-05-04T08:35:39.000Z" title="发表于 2024-05-04 16:35:39">2024-05-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/03/%E5%B5%8C%E5%85%A5%E5%BC%8FLinux%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%9E%84%E5%BB%BA/" title="嵌入式Linux系统的构建"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/05/03/yIu4n2xM.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="嵌入式Linux系统的构建"/></a><div class="content"><a class="title" href="/2024/05/03/%E5%B5%8C%E5%85%A5%E5%BC%8FLinux%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%9E%84%E5%BB%BA/" title="嵌入式Linux系统的构建">嵌入式Linux系统的构建</a><time datetime="2024-05-03T02:49:31.000Z" title="发表于 2024-05-03 10:49:31">2024-05-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/03/%E5%B5%8C%E5%85%A5%E5%BC%8F%E8%BD%AF%E4%BB%B6%E9%9D%A2%E8%AF%95%E9%A2%98/" title="嵌入式面试题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/05/05/HCN50noR.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="嵌入式面试题"/></a><div class="content"><a class="title" href="/2024/05/03/%E5%B5%8C%E5%85%A5%E5%BC%8F%E8%BD%AF%E4%BB%B6%E9%9D%A2%E8%AF%95%E9%A2%98/" title="嵌入式面试题">嵌入式面试题</a><time datetime="2024-05-03T02:49:31.000Z" title="发表于 2024-05-03 10:49:31">2024-05-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/03/%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5/" title="线程同步"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="//img2.imgtp.com/2024/05/05/5xd3Cvv5.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="线程同步"/></a><div class="content"><a class="title" href="/2024/05/03/%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5/" title="线程同步">线程同步</a><time datetime="2024-05-03T02:49:31.000Z" title="发表于 2024-05-03 10:49:31">2024-05-03</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2024 By <a class="footer-bar-link" href="/" title="Ten" target="_blank">Ten</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">11</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">3</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/music/"><span> 音乐馆</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 我的装备</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/linux/" style="font-size: 0.88rem;">linux<sup>8</sup></a><a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/" style="font-size: 0.88rem;">嵌入式<sup>2</sup></a><a href="/tags/%E7%BA%BF%E7%A8%8B/" style="font-size: 0.88rem;">线程<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" style="font-size: 0.88rem;">网络编程<sup>1</sup></a><a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 0.88rem;">设计模式<sup>1</sup></a><a href="/tags/%E8%BF%9B%E7%A8%8B/" style="font-size: 0.88rem;">进程<sup>2</sup></a><a href="/tags/%E9%80%9A%E4%BF%A1/" style="font-size: 0.88rem;">通信<sup>1</sup></a><a href="/tags/%E9%9A%8F%E7%AC%94/" style="font-size: 0.88rem;">随笔<sup>2</sup></a><a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 0.88rem;">面试<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.cbd.int/pangu@4.0.7/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (true){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'default' : 'light'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.cbd.int/mermaid@10.2.4/dist/mermaid.min.js').then(runMermaid)
  }

  anzhiyu.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>